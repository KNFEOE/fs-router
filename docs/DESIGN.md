# FileBasedReactRouter è®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [çº¦å®šå¼è·¯ç”±](#çº¦å®šå¼è·¯ç”±)
- [æ’ä»¶ç³»ç»Ÿ](#æ’ä»¶ç³»ç»Ÿ)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [ç±»å‹ç³»ç»Ÿ](#ç±»å‹ç³»ç»Ÿ)

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

FileBasedReactRouter æ˜¯ä¸€ä¸ªåŸºäºæ–‡ä»¶ç³»ç»Ÿçš„çº¦å®šå¼è·¯ç”±è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨ä¸º React åº”ç”¨æä¾›ç±»å‹å®‰å…¨ã€é«˜æ€§èƒ½çš„è·¯ç”±ç®¡ç†ã€‚è¯¥é¡¹ç›®å€Ÿé‰´äº† Modern.jsã€Next.jsã€Remix ç­‰ç°ä»£æ¡†æ¶çš„è·¯ç”±è®¾è®¡ç†å¿µï¼ŒåŒæ—¶ä¿æŒäº†è½»é‡çº§å’Œé«˜åº¦å¯å®šåˆ¶çš„ç‰¹æ€§ã€‚

### æ ¸å¿ƒç›®æ ‡

1. **ç®€åŒ–è·¯ç”±ç®¡ç†** - é€šè¿‡æ–‡ä»¶ç³»ç»Ÿçº¦å®šè‡ªåŠ¨ç”Ÿæˆè·¯ç”±é…ç½®
2. **ç±»å‹å®‰å…¨** - æä¾›å®Œæ•´çš„ TypeScript æ”¯æŒ
3. **é«˜æ€§èƒ½** - æ”¯æŒä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
4. **å¼€å‘ä½“éªŒ** - çƒ­æ›´æ–°å’Œå®æ—¶è·¯ç”±ç”Ÿæˆ
5. **æ„å»ºå·¥å…·é›†æˆ** - æ”¯æŒä¸»æµæ„å»ºå·¥å…·

## ğŸ—ï¸ è®¾è®¡ç†å¿µ

### çº¦å®šä¼˜äºé…ç½®

é¡¹ç›®é‡‡ç”¨"çº¦å®šä¼˜äºé…ç½®"çš„è®¾è®¡ç†å¿µï¼Œé€šè¿‡æ–‡ä»¶ç³»ç»Ÿçš„ç»„ç»‡ç»“æ„æ¥å®šä¹‰è·¯ç”±ç»“æ„ï¼Œå‡å°‘é…ç½®çš„å¤æ‚æ€§ã€‚

### ç±»å‹å®‰å…¨ä¼˜å…ˆ

ä»è®¾è®¡ä¹‹åˆå°±è€ƒè™‘ TypeScript æ”¯æŒï¼Œç¡®ä¿è·¯ç”±å‚æ•°ã€æŸ¥è¯¢å‚æ•°ç­‰éƒ½å…·æœ‰å®Œæ•´çš„ç±»å‹æ¨å¯¼ã€‚

### æ’ä»¶åŒ–æ¶æ„

é‡‡ç”¨æ’ä»¶åŒ–è®¾è®¡ï¼Œæ”¯æŒå¤šç§æ„å»ºå·¥å…·ï¼Œä¾¿äºæ‰©å±•å’Œå®šåˆ¶ã€‚

## ğŸ›ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–‡ä»¶ç³»ç»Ÿæ‰«æ    â”‚â”€â”€â”€â–¶â”‚   è·¯ç”±æ ‘ç”Ÿæˆ      â”‚â”€â”€â”€â–¶â”‚   ä»£ç ç”Ÿæˆ       â”‚
â”‚  (Extractor)    â”‚    â”‚  (RouteNode)    â”‚    â”‚  (Generator)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è·¯å¾„è§£æ       â”‚    â”‚   ç±»å‹è§£æ        â”‚    â”‚   æ’ä»¶ç³»ç»Ÿ       â”‚
â”‚  (PathParser)   â”‚    â”‚  (RouteFileParser)â”‚  â”‚  (Plugin)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

1. **æ–‡ä»¶æ‰«æ** - `RouteExtractor` æ‰«æè·¯ç”±ç›®å½•
2. **è·¯å¾„è§£æ** - `pathParser` è§£æåŠ¨æ€è·¯ç”±å‚æ•°
3. **ç±»å‹è§£æ** - `parseRouteFile` è§£æ TypeScript ç±»å‹
4. **è·¯ç”±æ ‘æ„å»º** - æ„å»º `RouteNode` æ ‘ç»“æ„
5. **ä»£ç ç”Ÿæˆ** - `RouteCodeGenerator` ç”Ÿæˆ React Router é…ç½®
6. **æ’ä»¶å¤„ç†** - å„æ„å»ºå·¥å…·æ’ä»¶é›†æˆ

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. RouteExtractor (è·¯ç”±æå–å™¨)

**èŒè´£**: æ‰«ææ–‡ä»¶ç³»ç»Ÿå¹¶æ„å»ºè·¯ç”±æ ‘

**æ ¸å¿ƒåŠŸèƒ½**:
- é€’å½’æ‰«æè·¯ç”±ç›®å½•
- è¯†åˆ«çº¦å®šå¼è·¯ç”±æ–‡ä»¶
- æ„å»ºåµŒå¥—è·¯ç”±ç»“æ„
- å¤„ç†åŠ¨æ€è·¯ç”±å‚æ•°

**å…³é”®æ–¹æ³•**:
```typescript
class RouteExtractor {
  async extract(): Promise<RouteNode[]>
  private async walkDirectory(dirname: string): Promise<RouteNode | null>
  private optimizeRoute(routeTree: RouteNode): RouteNode[]
}
```

### 2. PathParser (è·¯å¾„è§£æå™¨)

**èŒè´£**: è§£ææ–‡ä»¶è·¯å¾„ä¸ºè·¯ç”±è·¯å¾„å’Œå‚æ•°

**æ”¯æŒçš„åŠ¨æ€è·¯ç”±æ¨¡å¼**:
- `[param]` - å¿…éœ€å‚æ•°
- `[[param]]` - å¯é€‰å‚æ•°
- `[param$]` - å¯é€‰å‚æ•°ï¼ˆå¦ä¸€ç§è¯­æ³•ï¼‰
- `$` - catch-all è·¯ç”±
- `[[...param]]` - å¯é€‰ catch-all å‚æ•°

**ç¤ºä¾‹**:
```typescript
pathParser("user/[id]/[type$]")
// ç»“æœ: { route: "user/:id/:type?", params: [...] }
```

### 3. RouteFileParser (è·¯ç”±æ–‡ä»¶è§£æå™¨)

**èŒè´£**: è§£æè·¯ç”±æ–‡ä»¶ä¸­çš„ TypeScript ç±»å‹å®šä¹‰

**åŠŸèƒ½**:
- è§£æ `PageQueryParams` ç±»å‹å®šä¹‰
- æ”¯æŒè”åˆç±»å‹ã€äº¤å‰ç±»å‹
- æå–æŸ¥è¯¢å‚æ•°ç±»å‹ä¿¡æ¯
- ç”Ÿæˆç±»å‹å®‰å…¨çš„å¯¼èˆªä»£ç 

### 4. RouteCodeGenerator (è·¯ç”±ä»£ç ç”Ÿæˆå™¨)

**èŒè´£**: ç”Ÿæˆ React Router é…ç½®ä»£ç 

**ç‰¹æ€§**:
- æ”¯æŒä»£ç åˆ†å‰²
- æ‡’åŠ è½½ç»„ä»¶
- é”™è¯¯è¾¹ç•Œå¤„ç†
- åŠ è½½çŠ¶æ€ç®¡ç†

**ç”Ÿæˆçš„ä»£ç ç»“æ„**:
```typescript
import loadable from '@loadable/component';

const Component_0 = loadable(() => import(/* webpackChunkName: "user" */ './routes/user/page.tsx'));

export const routes = [
  {
    path: '/user',
    element: <Component_0 />
  }
];
```

### 5. Plugin System (æ’ä»¶ç³»ç»Ÿ)

**èŒè´£**: é›†æˆå„ç§æ„å»ºå·¥å…·

**æ”¯æŒçš„æ„å»ºå·¥å…·**:
- Vite
- Webpack  
- Rspack

**æ ¸å¿ƒåŠŸèƒ½**:
- æ–‡ä»¶ç›‘å¬å’Œçƒ­æ›´æ–°
- å¼€å‘/ç”Ÿäº§ç¯å¢ƒé€‚é…
- è™šæ‹Ÿæ¨¡å—å¤„ç†

## ğŸ“ çº¦å®šå¼è·¯ç”±

### æ–‡ä»¶å‘½åçº¦å®š

| æ–‡ä»¶å | ç”¨é€” | è·¯ç”±è¡Œä¸º |
|--------|------|----------|
| `layout.tsx` | å¸ƒå±€ç»„ä»¶ | åµŒå¥—å¸ƒå±€ |
| `page.tsx` | é¡µé¢ç»„ä»¶ | ç´¢å¼•è·¯ç”± |
| `$.tsx` | Catch-all è·¯ç”± | åŒ¹é…æ‰€æœ‰æœªåŒ¹é…è·¯å¾„ |
| `loading.tsx` | åŠ è½½ç»„ä»¶ | è·¯ç”±åŠ è½½çŠ¶æ€ |
| `error.tsx` | é”™è¯¯ç»„ä»¶ | é”™è¯¯è¾¹ç•Œ |
| `*.data.ts` | æ•°æ®åŠ è½½å™¨ | æœåŠ¡ç«¯æ•°æ®åŠ è½½ |
| `*.data.client.ts` | å®¢æˆ·ç«¯æ•°æ®åŠ è½½å™¨ | å®¢æˆ·ç«¯æ•°æ®åŠ è½½ |
| `*.loader.ts` | åŠ è½½å™¨ | è·¯ç”±åŠ è½½å™¨ |
| `*.config.ts` | è·¯ç”±é…ç½® | è·¯ç”±å…ƒæ•°æ® |

### ç›®å½•ç»“æ„çº¦å®š

```
routes/
â”œâ”€â”€ layout.tsx              # æ ¹å¸ƒå±€
â”œâ”€â”€ page.tsx                # é¦–é¡µ (/)
â”œâ”€â”€ about/
â”‚   â””â”€â”€ page.tsx            # /about
â”œâ”€â”€ user/
â”‚   â”œâ”€â”€ layout.tsx          # ç”¨æˆ·é¡µé¢å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx            # /user
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ page.tsx        # /user/:id
â”œâ”€â”€ (auth)/                 # è·¯ç”±åˆ†ç»„ï¼ˆä¸å½±å“ URLï¼‰
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ page.tsx        # /login
â”‚   â””â”€â”€ register/
â”‚       â””â”€â”€ page.tsx        # /register
â””â”€â”€ error.tsx               # é”™è¯¯é¡µé¢
```

### ç‰¹æ®Šç›®å½•å¤„ç†

- `(group)` - è·¯ç”±åˆ†ç»„ï¼Œä¸å½±å“ URL ç»“æ„
- `__dirname` - æ— è·¯å¾„å¸ƒå±€ï¼Œç”¨äºå…±äº«å¸ƒå±€
- `$.tsx` - catch-all è·¯ç”±ï¼ŒåŒ¹é…æ‰€æœ‰æœªåŒ¹é…è·¯å¾„

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

### æ’ä»¶æ¶æ„

æ’ä»¶ç³»ç»ŸåŸºäº `unplugin` æ„å»ºï¼Œæä¾›ç»Ÿä¸€çš„æ’ä»¶æ¥å£ï¼š

```typescript
interface RouterGeneratorPluginContext {
  root: string;
  config: PluginConfig;
  watcher: FSWatcher | null;
  lock: boolean;
  generated: boolean;
}
```

### é…ç½®é€‰é¡¹

```typescript
interface PluginConfig {
  routesDirectory: string;        // è·¯ç”±ç›®å½•
  generatedRoutesPath: string;    // ç”Ÿæˆçš„è·¯ç”±æ–‡ä»¶è·¯å¾„
  routeExtensions?: string[];     // æ”¯æŒçš„æ–‡ä»¶æ‰©å±•å
  enableGeneration?: boolean;     // æ˜¯å¦å¯ç”¨è·¯ç”±ç”Ÿæˆ
  alias?: {                       // è·¯å¾„åˆ«å
    name: string;
    basename: string;
  };
  splitting?: boolean;            // æ˜¯å¦å¯ç”¨ä»£ç åˆ†å‰²
  defaultErrorBoundary?: boolean; // æ˜¯å¦ä½¿ç”¨é»˜è®¤é”™è¯¯è¾¹ç•Œ
  typeGenerateOptions?: GenerateRouteTypeOptions; // ç±»å‹ç”Ÿæˆé€‰é¡¹
}
```

### æ„å»ºå·¥å…·é€‚é…

#### Vite æ’ä»¶
- æ”¯æŒ HMR çƒ­æ›´æ–°
- è™šæ‹Ÿæ¨¡å—å¤„ç†
- å¼€å‘æœåŠ¡å™¨é›†æˆ

#### Webpack æ’ä»¶
- ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
- æ–‡ä»¶ç›‘å¬
- ä»£ç åˆ†å‰²æ”¯æŒ

#### Rspack æ’ä»¶
- ä¸ Webpack å…¼å®¹çš„ API
- æ›´å¿«çš„æ„å»ºé€Ÿåº¦

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ä»£ç åˆ†å‰²

- åŸºäºè·¯ç”±çš„ä»£ç åˆ†å‰²
- åŠ¨æ€å¯¼å…¥æ”¯æŒ
- é¢„åŠ è½½ä¼˜åŒ–

### æ‡’åŠ è½½

- ç»„ä»¶çº§åˆ«çš„æ‡’åŠ è½½
- åŠ è½½çŠ¶æ€ç®¡ç†
- é”™è¯¯è¾¹ç•Œå¤„ç†

### ç¼“å­˜ç­–ç•¥

- è·¯ç”±é…ç½®ç¼“å­˜
- æ–‡ä»¶ç›‘å¬ä¼˜åŒ–
- å¢é‡æ›´æ–°

## ğŸ”’ ç±»å‹ç³»ç»Ÿ

### è·¯ç”±ç±»å‹ç”Ÿæˆ

è‡ªåŠ¨ç”ŸæˆåŸºäºæ–‡ä»¶ç³»ç»Ÿçš„è·¯ç”±ç±»å‹ï¼š

```typescript
interface RouteTypes {
  '/': {};
  '/about': {};
  '/user': {};
  '/user/:id': { id: string };
  '/user/:id/:type?': { id: string; type?: string };
}
```

### ç±»å‹å®‰å…¨å¯¼èˆª

æä¾›ç±»å‹å®‰å…¨çš„å¯¼èˆª APIï¼š

```typescript
const navigation = useNavigation();

// ç±»å‹å®‰å…¨çš„å¯¼èˆª
navigation.push('/user', { id: '123' });
navigation.push('/user/:id/:type?', { id: '123', type: 'profile' });
```

### æŸ¥è¯¢å‚æ•°ç±»å‹

æ”¯æŒæŸ¥è¯¢å‚æ•°çš„ç±»å‹æ¨å¯¼ï¼š

```typescript
// åœ¨è·¯ç”±æ–‡ä»¶ä¸­å®šä¹‰
export type PageQueryParams = {
  search?: string;
  page: number;
  category: 'all' | 'featured';
};

// è‡ªåŠ¨æ¨å¯¼æŸ¥è¯¢å‚æ•°ç±»å‹
navigation.push('/search', undefined, {
  search: 'react',
  page: 1,
  category: 'featured'
});
```

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### å¼€å‘æ¨¡å¼

1. **æ–‡ä»¶ç›‘å¬** - ç›‘å¬è·¯ç”±ç›®å½•å˜åŒ–
2. **å®æ—¶ç”Ÿæˆ** - æ–‡ä»¶å˜æ›´æ—¶é‡æ–°ç”Ÿæˆè·¯ç”±
3. **çƒ­æ›´æ–°** - æ”¯æŒ HMR çƒ­æ›´æ–°
4. **ç±»å‹æ£€æŸ¥** - å®æ—¶ç±»å‹é”™è¯¯æ£€æŸ¥

### ç”Ÿäº§æ¨¡å¼

1. **é¢„æ„å»º** - æ„å»ºæ—¶ç”Ÿæˆè·¯ç”±é…ç½®
2. **ä»£ç åˆ†å‰²** - ä¼˜åŒ–åŒ…å¤§å°
3. **ç±»å‹ç”Ÿæˆ** - ç”Ÿæˆå®Œæ•´çš„ç±»å‹å®šä¹‰
4. **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯è¾¹ç•Œ

## ğŸ“ æ€»ç»“

FileBasedReactRouter é€šè¿‡çº¦å®šå¼è·¯ç”±ã€ç±»å‹å®‰å…¨å’Œæ’ä»¶åŒ–æ¶æ„ï¼Œä¸º React åº”ç”¨æä¾›äº†ç°ä»£åŒ–çš„è·¯ç”±è§£å†³æ–¹æ¡ˆã€‚å…¶è®¾è®¡å……åˆ†è€ƒè™‘äº†å¼€å‘ä½“éªŒã€æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºæ„å»ºå¤§å‹ React åº”ç”¨æä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚